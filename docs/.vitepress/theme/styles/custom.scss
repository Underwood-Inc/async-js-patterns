@use 'sass:color';
@use './_variables.scss' as vars;

// Purple theme variables
$purple-light: #f8f7fc;
$purple-dark: #2a2438;
$purple-brand: #9d8cd6;
$purple-brand-light: #b3a5e3;
$purple-brand-dark: #7a69b3;
$purple-gray-100: #f3f0ff;
$purple-gray-200: #e9e4ff;
$purple-gray-300: #d4ccf4;
$purple-gray-400: #b4a6e5;
$purple-gray-500: #9d8cd6;
$purple-gray-600: #7a69b3;
$purple-gray-700: #5d4d94;
$purple-gray-800: #413369;
$purple-gray-900: #2a2438;

// Update the code background variables
$code-bg-light: #{color.adjust($purple-light, $lightness: -5%)}; // Much lighter background
$code-bg-dark: #{color.adjust($purple-dark, $lightness: -5%)}; // Keep dark theme dark

// Breakpoint mixins
$breakpoints: (
  'sm': 640px,
  'md': 768px,
  'lg': 1024px,
  'xl': 1280px,
);

@mixin respond-to($breakpoint) {
  @if map-has-key($breakpoints, $breakpoint) {
    @media (min-width: map-get($breakpoints, $breakpoint)) {
      @content;
    }
  } @else {
    @warn "No breakpoint found for '#{$breakpoint}'";
  }
}

:root {
  // Light theme
  --vp-c-bg: #{$purple-light};
  --vp-c-bg-alt: #{$purple-gray-100};
  --vp-c-bg-soft: #{$purple-gray-200};

  --vp-c-brand: #{$purple-brand};
  --vp-c-brand-light: #{$purple-brand-light};
  --vp-c-brand-lighter: #{$purple-gray-300};
  --vp-c-brand-dark: #{$purple-brand-dark};
  --vp-c-brand-darker: #{$purple-gray-700};

  // Text colors with proper contrast
  --vp-c-text-1: #{$purple-gray-900};
  --vp-c-text-2: #{$purple-gray-800};
  --vp-c-text-3: #{$purple-gray-700};

  // Sidebar and navigation - lighter sidebar
  --vp-sidebar-bg-color: #{color.mix($purple-light, $purple-gray-100, 70%)}; // Lighter, more subtle sidebar
  --vp-nav-bg-color: #{$purple-gray-200}; // Top navigation background

  // Light theme highlight
  --vp-c-search-highlight: #{color.adjust($purple-brand, $alpha: -0.7)}; // More transparent
  --vp-c-search-highlight-text: #{$purple-dark}; // Ensure text remains readable

  --vp-z-index-nav: #{vars.get-z-index('nav')};
  --vp-z-index-tooltip: #{vars.get-z-index('tooltip')};
  --vp-z-index-code-block: #{vars.get-z-index('code-block')};
}

.dark {
  // Dark theme
  --vp-c-bg: #{$purple-dark};
  --vp-c-bg-alt: #{color.adjust($purple-dark, $lightness: 5%)};
  --vp-c-bg-soft: #{color.adjust($purple-dark, $lightness: 3%)};

  // Text colors for dark mode
  --vp-c-text-1: #{$purple-gray-100};
  --vp-c-text-2: #{$purple-gray-200};
  --vp-c-text-3: #{$purple-gray-300};

  // Sidebar and navigation - adjusted for dark mode
  --vp-sidebar-bg-color: #{color.adjust($purple-dark, $lightness: -3%)}; // Slightly darker than bg
  --vp-nav-bg-color: #{color.adjust($purple-dark, $lightness: -5%)}; // Top navigation background

  // Dark theme highlight
  --vp-c-search-highlight: #{color.adjust($purple-brand-light, $alpha: -0.8)}; // More transparent
  --vp-c-search-highlight-text: #{$purple-light}; // Light text for dark theme
}

// Sidebar styles with enhanced contrast for links
.VPSidebar {
  background-color: var(--vp-sidebar-bg-color) !important;

  .VPSidebarItem.is-active .text {
    color: var(--vp-c-brand-dark) !important; // Darker purple for active links
  }

  .VPSidebarItem .text {
    color: var(--vp-c-text-2) !important; // Better contrast for regular links
  }
}

// Top navigation styles
.VPNavBar {
  background-color: var(--vp-nav-bg-color) !important;
  z-index: var(--vp-z-index-nav) !important;
}

// Title container styles
.VPNavBarTitle {
  background-color: var(--vp-nav-bg-color) !important;
}

.VPSidebarItem.level-0.is-link.is-active,
.VPSidebarItem.level-1.is-link.is-active,
.VPSidebarItem.level-2.is-link.is-active {
  background: var(--vp-c-brand-soft) !important;
}

.VPSidebarItem.level-0.is-link:hover,
.VPSidebarItem.level-1.is-link:hover,
.VPSidebarItem.level-2.is-link:hover {
  background: var(--vp-c-bg-soft) !important;
}

.VPSidebarItem .text {
  color: var(--vp-c-text) !important;
}

.VPSidebarItem.is-active .text {
  color: var(--vp-c-brand) !important;
  font-weight: 600;
}

// Hero section gradient text
.name,
.text {
  background: -webkit-linear-gradient(
    120deg,
    var(--vp-c-brand-light) 30%,
    var(--vp-c-brand)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.dark .name,
.dark .text {
  background: -webkit-linear-gradient(
    120deg,
    var(--vp-c-brand-light) 30%,
    var(--vp-c-brand)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

// Code block styles
.vp-doc {
  div[class*='language-'] {
    background-color: $code-bg-light !important;
    border: 2px solid var(--vp-c-brand) !important;
    border-radius: 8px !important;
    margin: 1rem 0;
    box-shadow: 0 0 8px rgba($purple-brand, 0.1);

    code {
      color: var(--vp-c-text-1);
    }

    // Dark mode adjustments
    .dark & {
      background-color: $code-bg-dark !important;
      border-color: var(--vp-c-brand-dark) !important;
      box-shadow: 0 0 8px rgba($purple-brand, 0.2);
    }
  }

  pre,
  code {
    background: transparent;
  }
}

// Add padding to left nav link items
.VPLink.link.link {
  padding: 0.5rem 1rem; // Add padding to create space around the text
  border-radius: 4px; // Optional: Add border-radius for a smoother look

  &:hover {
    background-color: var(
      --vp-c-bg-soft
    ); // Ensure hover background color is consistent
  }
}

// Global highlight color
::selection {
  background-color: #{color.adjust($purple-brand, $alpha: -0.7)} !important;
  color: #{color.adjust($purple-dark, $lightness: -20%)} !important;
}

.dark ::selection {
  background-color: #{color.adjust($purple-brand, $alpha: -0.7)} !important;
  color: #{color.adjust($purple-light, $lightness: -20%)} !important;
}

// Search result highlight override
mark[data-markjs='true'] {
  background-color: #{color.adjust($purple-brand, $alpha: -0.8)} !important;
  color: #{color.adjust($purple-dark, $lightness: -40%)} !important;
}

.title .text mark[data-markjs='true'] {
  background-color: #{color.adjust($purple-brand, $alpha: -0.85)} !important;
}

.dark mark[data-markjs='true'] {
  background-color: #{color.adjust($purple-brand, $alpha: -0.8)} !important;
  color: #{color.adjust($purple-light, $lightness: -20%)} !important;
}

// Modern, rounded scrollbar styles
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: #{color.adjust($purple-light, $lightness: -2%)};
  border-radius: 10px; // More rounded track
}

::-webkit-scrollbar-thumb {
  background: #{color.adjust($purple-brand, $alpha: -0.5)};
  border-radius: 10px; // More rounded thumb
  border: 3px solid transparent;
  background-clip: padding-box;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); // Subtle shadow for depth

  &:hover {
    background: #{color.adjust($purple-brand, $alpha: -0.3)};
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.2); // Enhanced shadow on hover
  }
}

// Dark theme scrollbar
.dark {
  ::-webkit-scrollbar-track {
    background: #{color.adjust($purple-dark, $lightness: 5%)};
  }

  ::-webkit-scrollbar-thumb {
    background: #{color.adjust($purple-brand-dark, $alpha: -0.5)};

    &:hover {
      background: #{color.adjust($purple-brand-dark, $alpha: -0.3)};
    }
  }
}

// Add nav styles
.VPNav {
  .VPNavBarMenuLink {
    height: var(--vp-nav-height);
    line-height: var(--vp-nav-height);

    &:hover {
      background-color: var(--vp-c-bg-soft);
    }
  }

  .VPNavBarMenuGroup {
    .link {
      height: var(--vp-nav-height);
      line-height: var(--vp-nav-height);

      &:hover {
        background-color: var(--vp-c-bg-soft);
      }
    }
  }

  z-index: var(--vp-z-index-nav) !important;
}

// Add tooltip styles
.tooltip-portal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 9999;
}

// Base tooltip styles
.has-tooltip {
  text-decoration: underline;
  text-decoration-style: dotted;
  text-decoration-color: var(--vp-c-brand);
  text-decoration-thickness: 1px;
  cursor: help;
  position: relative;

  &::before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 8px;
    background: var(--vp-c-bg-soft);
    border: 1px solid var(--vp-c-divider);
    border-radius: 6px;
    font-size: 12px;
    white-space: pre-wrap;
    z-index: vars.get-z-index('tooltip');
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.2s,
      visibility 0.2s;
    max-width: 300px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  &:hover::before {
    opacity: 1;
    visibility: visible;
  }
}

// Error tooltip styles
.has-error {
  text-decoration: underline;
  text-decoration-style: wavy;
  text-decoration-color: rgba(255, 100, 100, 0.8);
  text-decoration-thickness: 2px;
}

// Stacked tooltip container
.tooltip-stack {
  position: relative;
  display: inline-block;
}

// Stacked tooltip content
.tooltip-stack .has-tooltip::before {
  margin-bottom: 4px; // Space between stacked tooltips
  z-index: vars.get-z-index('tooltip');
}

.tooltip-stack .has-error::before {
  background: rgba(255, 100, 100, 0.1);
  border-color: rgba(255, 100, 100, 0.3);
  margin-bottom: 8px; // More space for error tooltips
}

.error-tooltip {
  color: #ff6b6b;
  font-family: var(--vp-font-family-mono);
  white-space: pre-wrap;
  font-size: 0.9em;
}

// Tooltip trigger styles
.tooltip-trigger {
  text-decoration: underline;
  text-decoration-style: dotted;
  text-decoration-color: var(--vp-c-brand);
  text-decoration-thickness: 1px;
  cursor: help !important;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;

  &:active {
    opacity: 0.7;
  }

  &.has-error {
    text-decoration-style: wavy;
    text-decoration-color: rgba(255, 100, 100, 0.8);
    text-decoration-thickness: 2px;
    cursor: help !important;
  }
}

// Navigation z-index overrides
.VPNav {
  z-index: var(--vp-z-index-nav) !important;
}

.VPNavBar {
  z-index: var(--vp-z-index-nav) !important;
}

.VPNavScreen {
  z-index: var(--vp-z-index-nav) !important;
}

// Add styles for tooltip triggers
.tooltip-trigger {
  cursor: help;

  &.has-error {
    cursor: help;
  }
}
